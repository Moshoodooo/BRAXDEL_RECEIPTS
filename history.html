<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Braxdel â€“ Receipt History</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="index.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
/* Additional styles specific to history page */
.history-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: linear-gradient(135deg, var(--bg), var(--bg-alt));
  border: 2px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  transition: var(--transition);
}

.stat-card:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.stat-label {
  font-size: 0.8rem;
  color: var(--text-light);
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.stat-value {
  font-family: 'Outfit', sans-serif;
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--primary);
}

.history-table-container {
  overflow-x: auto;
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  background: var(--bg-alt);
}

#historyTable {
  width: 100%;
  border-collapse: collapse;
}

#historyTable thead {
  background: var(--secondary);
  position: sticky;
  top: 0;
  z-index: 10;
}

#historyTable th {
  padding: 1rem;
  text-align: left;
  color: white;
  font-weight: 600;
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
}

#historyTable th:first-child {
  border-radius: var(--radius-sm) 0 0 0;
}

#historyTable th:last-child {
  border-radius: 0 var(--radius-sm) 0 0;
  text-align: right;
}

#historyTable td {
  padding: 1rem;
  border-bottom: 1px solid var(--border);
  color: var(--text);
  font-size: 0.9rem;
}

#historyTable tbody tr {
  transition: var(--transition);
}

#historyTable tbody tr:hover {
  background: var(--bg);
}

#historyTable tbody tr:last-child td {
  border-bottom: none;
}

.action-cell {
  display: flex;
  gap: 0.5rem;
  justify-content: flex-end;
  align-items: center;
}

.btn-download, .btn-delete {
  padding: 0.5rem 1rem;
  border-radius: var(--radius-sm);
  border: none;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 600;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.btn-download {
  background: var(--primary);
  color: white;
  box-shadow: var(--shadow-sm);
}

.btn-download:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.btn-delete {
  background: #fee;
  color: var(--danger);
}

.btn-delete:hover {
  background: #fdd;
  transform: translateY(-1px);
}

.empty {
  text-align: center;
  padding: 4rem 2rem;
  color: var(--text-light);
}

.empty-icon {
  width: 80px;
  height: 80px;
  margin: 0 auto 1.5rem;
  background: var(--bg);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
}

.empty h3 {
  font-family: 'Outfit', sans-serif;
  font-size: 1.5rem;
  color: var(--text);
  margin-bottom: 0.5rem;
}

.empty p {
  color: var(--text-light);
  margin-bottom: 1.5rem;
}

/* Mobile Receipt Cards */
.receipt-card {
  display: none;
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
  margin-bottom: 1rem;
  transition: var(--transition);
}

.receipt-card:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
}

.receipt-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border);
}

.receipt-card-number {
  font-family: 'Outfit', sans-serif;
  font-weight: 700;
  color: var(--primary);
  font-size: 1.1rem;
}

.receipt-card-date {
  color: var(--text-light);
  font-size: 0.85rem;
  font-weight: 500;
}

.receipt-card-details {
  margin-bottom: 1rem;
}

.receipt-card-row {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  font-size: 0.9rem;
}

.receipt-card-label {
  color: var(--text-light);
  font-weight: 500;
}

.receipt-card-value {
  color: var(--text);
  font-weight: 600;
}

.receipt-card-total {
  color: var(--primary);
  font-weight: 700;
  font-size: 1.2rem;
}

.receipt-card-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.75rem;
}

.receipt-card-actions button {
  padding: 0.75rem;
  font-size: 0.9rem;
  justify-content: center;
}

/* Delete Modal Specific Styles */
#deleteModal .modal-icon {
  background: linear-gradient(135deg, #ff6b6b, var(--danger));
}

#deleteModal .modal-buttons {
  display: flex;
  gap: 0.75rem;
  justify-content: center;
  margin-top: 1.5rem;
}

#deleteModal .btn-cancel {
  background: var(--bg);
  color: var(--text);
  padding: 0.875rem 2rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  border: 2px solid var(--border);
  cursor: pointer;
  transition: var(--transition);
}

#deleteModal .btn-cancel:hover {
  border-color: var(--text);
  background: var(--border);
}

#deleteModal .btn-confirm-delete {
  background: var(--danger);
  color: white;
  padding: 0.875rem 2rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-md);
  transition: var(--transition);
}

#deleteModal .btn-confirm-delete:hover {
  background: #dc2626;
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

/* Loading State */
.loading {
  text-align: center;
  padding: 3rem;
  color: var(--text-light);
}

.loading-spinner {
  width: 50px;
  height: 50px;
  margin: 0 auto 1rem;
  border: 4px solid var(--border);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
  .history-stats {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .stat-card {
    padding: 1.25rem;
  }

  .stat-value {
    font-size: 1.5rem;
  }

  .history-table-container {
    display: none !important;
  }

  .receipt-card {
    display: block;
  }

  .empty {
    padding: 3rem 1.5rem;
  }

  .empty-icon {
    width: 60px;
    height: 60px;
    font-size: 2rem;
  }

  .empty h3 {
    font-size: 1.25rem;
  }
}

@media (max-width: 480px) {
  .receipt-card {
    padding: 1rem;
  }

  .receipt-card-number {
    font-size: 0.95rem;
  }

  .receipt-card-date {
    font-size: 0.75rem;
  }
}
</style>
</head>

<body>

<header>
  <div class="header-container">
    <div class="header-left">
      <div class="logo-wrapper">
        <img src="images/BRAXDEL.png" alt="Braxdel Logo">
      </div>
      <div class="brand-text">
        <span class="brand-name">Receipt History</span>
        <span class="brand-tagline">View & Manage</span>
      </div>
    </div>

    <a href="index.html" class="nav-btn">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      <span>Back</span>
    </a>
  </div>
</header>

<main>
  <section class="card">
    <div class="card-header">
      <h2>Receipt History</h2>
      <p class="card-subtitle">View and download all your generated receipts</p>
    </div>

    <div id="loadingState" class="loading">
      <div class="loading-spinner"></div>
      <p>Loading receipts...</p>
    </div>

    <div id="statsSection" class="history-stats" style="display:none">
      <div class="stat-card">
        <span class="stat-label">Total Receipts</span>
        <span class="stat-value" id="totalCount">0</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Total Revenue</span>
        <span class="stat-value" id="totalRevenue">NGN 0</span>
      </div>
    </div>

    <div class="history-table-container" id="tableContainer" style="display:none">
      <table id="historyTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Receipt #</th>
            <th>Customer</th>
            <th>Payment</th>
            <th>Total</th>
            <th style="text-align:right">Actions</th>
          </tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
    </div>

    <div id="mobileCards"></div>

    <div id="emptyState" class="empty" style="display:none">
      <div class="empty-icon">ðŸ“‹</div>
      <h3>No Receipts Yet</h3>
      <p>Start creating receipts to see them appear here</p>
      <a href="index.html" class="btn-primary" style="display:inline-flex;width:auto;text-decoration:none;margin-top:1rem;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Create First Receipt</span>
      </a>
    </div>
  </section>
</main>

<div id="successModal" class="modal">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <div class="modal-icon">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
    <h3>Receipt Downloaded!</h3>
    <p>Your PDF has been successfully generated</p>
    <button class="modal-close" onclick="document.getElementById('successModal').style.display='none'">Got it</button>
  </div>
</div>

<div id="deleteModal" class="modal">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <div class="modal-icon">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M3 6h18"></path>
        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
      </svg>
    </div>
    <h3>Delete Receipt?</h3>
    <p>This action cannot be undone. The receipt will be permanently removed from the database.</p>
    <div class="modal-buttons">
      <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="btn-confirm-delete" id="confirmDeleteBtn">Delete Receipt</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, collection, getDocs, doc, deleteDoc, query, orderBy, getDoc 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCfJoT1cXPjP-ua5Eo-2LOvoFr-389PXD0",
    authDomain: "braxdel-receips.firebaseapp.com",
    projectId: "braxdel-receips",
    storageBucket: "braxdel-receips.firebasestorage.app",
    messagingSenderId: "21198058228",
    appId: "1:21198058228:web:560818029764609c2364a1",
    measurementId: "G-M8YW9JY85E"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const historyBody = document.getElementById("historyBody");
  const mobileCards = document.getElementById("mobileCards");
  const emptyState = document.getElementById("emptyState");
  const tableContainer = document.getElementById("tableContainer");
  const loadingState = document.getElementById("loadingState");
  const statsSection = document.getElementById("statsSection");
  let currentDeleteId = null;

  async function loadHistory() {
    loadingState.style.display = "block";
    statsSection.style.display = "none";
    tableContainer.style.display = "none";
    emptyState.style.display = "none";
    
    try {
      const q = query(collection(db, "receipts"), orderBy("createdAt", "desc"));
      const querySnapshot = await getDocs(q);

      loadingState.style.display = "none";

      if (querySnapshot.empty) {
        emptyState.style.display = "block";
        return;
      }

      let totalRevenue = 0;
      const tableRows = [];
      const mobileCardsHTML = [];

      querySnapshot.forEach((docSnap) => {
        const r = docSnap.data();
        const id = docSnap.id;
        const dateStr = r.createdAt ? new Date(r.createdAt).toLocaleDateString() : 'N/A';
        const totalAmount = Number(r.total) || 0;
        const formattedTotal = totalAmount.toLocaleString();
        
        totalRevenue += totalAmount;

        // Table Row HTML
        tableRows.push(`
          <tr>
            <td>${dateStr}</td>
            <td><strong>${r.receiptNo}</strong></td>
            <td>${r.customer}</td>
            <td>${r.payment || 'N/A'}</td>
            <td><strong>NGN ${formattedTotal}</strong></td>
            <td>
              <div class="action-cell">
                <button class="btn-download" data-id="${id}">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Download
                </button>
                <button class="btn-delete" data-id="${id}">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                  Delete
                </button>
              </div>
            </td>
          </tr>
        `);

        // Mobile Card HTML
        mobileCardsHTML.push(`
          <div class="receipt-card">
            <div class="receipt-card-header">
              <div class="receipt-card-number">${r.receiptNo}</div>
              <div class="receipt-card-date">${dateStr}</div>
            </div>
            <div class="receipt-card-details">
              <div class="receipt-card-row">
                <span class="receipt-card-label">Customer</span>
                <span class="receipt-card-value">${r.customer}</span>
              </div>
              <div class="receipt-card-row">
                <span class="receipt-card-label">Payment</span>
                <span class="receipt-card-value">${r.payment || 'N/A'}</span>
              </div>
              <div class="receipt-card-row">
                <span class="receipt-card-label">Total</span>
                <span class="receipt-card-total">NGN ${formattedTotal}</span>
              </div>
            </div>
            <div class="receipt-card-actions">
              <button class="btn-download" data-id="${id}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download
              </button>
              <button class="btn-delete" data-id="${id}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Delete
              </button>
            </div>
          </div>
        `);
      });

      // Batch DOM updates
      historyBody.innerHTML = tableRows.join('');
      mobileCards.innerHTML = mobileCardsHTML.join('');
      document.getElementById("totalCount").textContent = querySnapshot.size;
      document.getElementById("totalRevenue").textContent = `NGN ${totalRevenue.toLocaleString()}`;

      statsSection.style.display = "grid";
      tableContainer.style.display = "block";

      attachButtonListeners();
    } catch (error) {
      console.error("Error fetching from Firestore:", error);
      loadingState.style.display = "none";
      emptyState.style.display = "block";
    }
  }

  function attachButtonListeners() {
    document.querySelectorAll('.btn-download').forEach(btn => {
      btn.onclick = () => downloadPDF(btn.getAttribute('data-id'));
    });
    document.querySelectorAll('.btn-delete').forEach(btn => {
      btn.onclick = () => {
        currentDeleteId = btn.getAttribute('data-id');
        document.getElementById('deleteModal').style.display = 'flex';
      };
    });
  }

  window.closeDeleteModal = () => {
    document.getElementById('deleteModal').style.display = 'none';
    currentDeleteId = null;
  };

  document.getElementById('confirmDeleteBtn').onclick = async () => {
    if (currentDeleteId) {
      await deleteDoc(doc(db, "receipts", currentDeleteId));
      window.closeDeleteModal();
      loadHistory();
    }
  };

  async function downloadPDF(id) {
    const docSnap = await getDoc(doc(db, "receipts", id));
    if (!docSnap.exists()) return;
    const receipt = docSnap.data();

    document.getElementById('successModal').style.display = 'flex';
    
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");
    const pageWidth = pdf.internal.pageSize.getWidth();
    let y = 20;

    // Header with Logo and Company Name
    const logo = await loadImage("images/BRAXDEL.png");
    if(logo) {
      pdf.addImage(logo, "PNG", 15, y, 25, 25);
    }
    
    pdf.setFont("helvetica", "bold");
    pdf.setFontSize(20);
    pdf.text("Braxdel Catering", 45, y + 10);
    pdf.setFontSize(12);
    pdf.setFont("helvetica", "normal");
    pdf.text("& Food Services", 45, y + 17);

    // Official Receipt Badge
    pdf.setFillColor(255, 107, 53);
    pdf.roundedRect(pageWidth - 60, y, 45, 10, 2, 2, 'F');
    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(9);
    pdf.setFont("helvetica", "bold");
    pdf.text("OFFICIAL RECEIPT", pageWidth - 37.5, y + 6.5, { align: "center" });

    // Orange line separator
    pdf.setDrawColor(255, 107, 53);
    pdf.setLineWidth(0.8);
    pdf.line(15, y + 30, pageWidth - 15, y + 30);

    y = y + 40;

    // Receipt Information Section
    pdf.setTextColor(0, 30, 64);
    pdf.setFillColor(248, 249, 252);
    pdf.roundedRect(15, y, pageWidth - 30, 35, 3, 3, 'F');

    pdf.setFontSize(8);
    pdf.setFont("helvetica", "bold");
    pdf.setTextColor(107, 114, 128);
    
    pdf.text("BILLED TO", 20, y + 7);
    pdf.text("DATE", 20, y + 18);
    pdf.text("RECEIPT #", pageWidth/2 + 5, y + 7);
    pdf.text("PAYMENT METHOD", pageWidth/2 + 5, y + 18);

    pdf.setFont("helvetica", "bold");
    pdf.setFontSize(10);
    pdf.setTextColor(31, 41, 55);
    
    pdf.text(receipt.customer, 20, y + 12);
    pdf.text(new Date(receipt.createdAt).toLocaleDateString(), 20, y + 23);
    pdf.text(receipt.receiptNo, pageWidth/2 + 5, y + 12);
    pdf.text(receipt.payment || 'N/A', pageWidth/2 + 5, y + 23);

    y = y + 45;

    // Table Header
    pdf.setFillColor(0, 30, 64);
    pdf.roundedRect(15, y, pageWidth - 30, 10, 2, 2, 'F');
    
    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(9);
    pdf.setFont("helvetica", "bold");
    pdf.text("Description", 20, y + 6.5);
    pdf.text("Qty", pageWidth - 80, y + 6.5);
    pdf.text("Price", pageWidth - 60, y + 6.5);
    pdf.text("Total", pageWidth - 30, y + 6.5, { align: "right" });

    y = y + 15;

    // Table Items
    pdf.setTextColor(31, 41, 55);
    pdf.setFont("helvetica", "normal");
    pdf.setFontSize(9);
    pdf.setDrawColor(229, 232, 239);
    pdf.setLineWidth(0.2);

    receipt.items.forEach((item, index) => {
      // Alternate row background
      if (index % 2 === 0) {
        pdf.setFillColor(248, 249, 252);
        pdf.rect(15, y - 5, pageWidth - 30, 10, 'F');
      }

      pdf.text(item.d, 20, y);
      pdf.text(String(item.q), pageWidth - 80, y);
      pdf.text(`NGN ${item.p.toLocaleString()}`, pageWidth - 60, y);
      pdf.text(`NGN ${item.t.toLocaleString()}`, pageWidth - 20, y, { align: "right" });
      
      // Bottom border
      pdf.line(15, y + 3, pageWidth - 15, y + 3);
      y += 10;
    });

    y += 5;

    // Total Section
    pdf.setFillColor(255, 107, 53, 0.1);
    pdf.setDrawColor(255, 107, 53);
    pdf.setLineWidth(0.5);
    pdf.roundedRect(15, y, pageWidth - 30, 15, 3, 3, 'FD');

    pdf.setFont("helvetica", "bold");
    pdf.setFontSize(10);
    pdf.setTextColor(31, 41, 55);
    pdf.text("TOTAL AMOUNT", 20, y + 10);

    pdf.setFontSize(16);
    pdf.setTextColor(255, 107, 53);
    pdf.text(`NGN ${Number(receipt.total).toLocaleString()}`, pageWidth - 20, y + 10, { align: "right" });

    y += 25;

    // Footer Section
    pdf.setDrawColor(200, 200, 200);
    pdf.setLineWidth(0.3);
    pdf.setLineDash([2, 2]);
    pdf.line(15, y, pageWidth - 15, y);
    pdf.setLineDash([]);

    y += 10;

    pdf.setFont("helvetica", "normal");
    pdf.setFontSize(9);
    pdf.setTextColor(107, 114, 128);
    pdf.text("Thank you for your patronage", 20, y);
    
    pdf.setFont("helvetica", "bold");
    pdf.setFontSize(9);
    pdf.setTextColor(31, 41, 55);
    pdf.text("Braxdel Catering & Food Services", 20, y + 5);

    // QR Code
    const tempDiv = document.createElement('div');
    new QRCode(tempDiv, {
      text: `https://luxury-lamington-0be902.netlify.app/verify.html?ref=${receipt.receiptNo}`,
      width: 90, height: 90
    });

    setTimeout(() => {
      const qrCanvas = tempDiv.querySelector("canvas");
      if (qrCanvas) {
        const qrImage = qrCanvas.toDataURL("image/png");
        pdf.addImage(qrImage, "PNG", pageWidth - 40, y - 5, 25, 25);
        pdf.setFontSize(7);
        pdf.setTextColor(156, 163, 175);
        pdf.text("Scan to verify", pageWidth - 27.5, y + 23, { align: "center" });
      }
      pdf.save(`Braxdel_${receipt.receiptNo}.pdf`);
    }, 150);
  }

  function loadImage(src) {
    return new Promise(res => {
      const img = new Image();
      img.onload = () => res(img);
      img.onerror = () => res(null);
      img.src = src;
    });
  }

  loadHistory();
</script>

</body>
</html>